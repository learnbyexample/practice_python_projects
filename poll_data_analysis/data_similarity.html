<!doctypehtml><html class="sidebar-visible no-js light"lang=en><head><meta charset=UTF-8><title>Data similarity - Practice Python Projects</title><meta content="text/html; charset=utf-8"http-equiv=Content-Type><meta content="Beginner to Intermediate level projects inspired by real world use cases"name=description><meta content=width=device-width,initial-scale=1 name=viewport><meta content=#ffffff name=theme-color><meta content="Practice Python Projects"property=og:title><meta content=website property=og:type><meta content="Beginner to Intermediate level projects inspired by real world use cases"property=og:description><meta content=https://learnbyexample.github.io/practice_python_projects/ property=og:url><meta content=https://raw.githubusercontent.com/learnbyexample/practice_python_projects/main/images/py_projects_ls.png property=og:image><meta content=1280 property=og:image:width><meta content=720 property=og:image:height><meta content=summary_large_image property=twitter:card><meta content=@learn_byexample property=twitter:site><link href=../favicon.svg rel=icon><link rel="shortcut icon"href=../favicon.png><link href=../css/variables.css rel=stylesheet><link href=../css/general.css rel=stylesheet><link href=../css/chrome.css rel=stylesheet><link href=../FontAwesome/css/font-awesome.css rel=stylesheet><link href=../fonts/fonts.css rel=stylesheet><link href=../highlight.css rel=stylesheet><link href=../tomorrow-night.css rel=stylesheet><link href=../ayu-highlight.css rel=stylesheet><link href=../style.css rel=stylesheet><body><script>var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";</script><script>try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }</script><script>var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');</script><script>var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);</script><nav aria-label="Table of contents"class=sidebar id=sidebar><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded affix"><a href=../cover.html>Cover</a><li class="chapter-item expanded affix"><a href=../buy.html>Buy PDF/EPUB versions</a><li class="chapter-item expanded affix"><a href=../preface.html>Preface</a><li class="chapter-item expanded"><a href=../calculator/calculator.html><strong aria-hidden=true>1.</strong> CLI Calculator</a><li><ol class=section><li class="chapter-item expanded"><a href=../calculator/calc_bash_func.html><strong aria-hidden=true>1.1.</strong> Bash shortcuts</a><li class="chapter-item expanded"><a href=../calculator/calc_py_cli.html><strong aria-hidden=true>1.2.</strong> Python CLI application</a><li class="chapter-item expanded"><a href=../calculator/exercises.html><strong aria-hidden=true>1.3.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../poll_data_analysis/poll_data_analysis.html><strong aria-hidden=true>2.</strong> Poll Data Analysis</a><li><ol class=section><li class="chapter-item expanded"><a href=../poll_data_analysis/praw.html><strong aria-hidden=true>2.1.</strong> Getting Reddit comments using praw</a><li class="chapter-item expanded"><a href=../poll_data_analysis/data_cleansing.html><strong aria-hidden=true>2.2.</strong> Data cleansing</a><li class="chapter-item expanded"><a class=active href=../poll_data_analysis/data_similarity.html><strong aria-hidden=true>2.3.</strong> Data similarity</a><li class="chapter-item expanded"><a href=../poll_data_analysis/exercises.html><strong aria-hidden=true>2.4.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../find_typos/find_typos.html><strong aria-hidden=true>3.</strong> Finding typos</a><li><ol class=section><li class="chapter-item expanded"><a href=../find_typos/plain_text.html><strong aria-hidden=true>3.1.</strong> Plain text input</a><li class="chapter-item expanded"><a href=../find_typos/markdown.html><strong aria-hidden=true>3.2.</strong> Markdown input</a><li class="chapter-item expanded"><a href=../find_typos/exercises.html><strong aria-hidden=true>3.3.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../mcq/multiple_choice_questions.html><strong aria-hidden=true>4.</strong> Multiple choice questions</a><li><ol class=section><li class="chapter-item expanded"><a href=../mcq/input_mcq.html><strong aria-hidden=true>4.1.</strong> Using input function</a><li class="chapter-item expanded"><a href=../mcq/tkinter_intro.html><strong aria-hidden=true>4.2.</strong> Tkinter introduction</a><li class="chapter-item expanded"><a href=../mcq/gui_mcq.html><strong aria-hidden=true>4.3.</strong> MCQ GUI</a><li class="chapter-item expanded"><a href=../mcq/exercises.html><strong aria-hidden=true>4.4.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../square_tic_tac_toe/square_tic_tac_toe.html><strong aria-hidden=true>5.</strong> Square Tic Tac Toe</a><li><ol class=section><li class="chapter-item expanded"><a href=../square_tic_tac_toe/grid_and_images.html><strong aria-hidden=true>5.1.</strong> Grid layout and images</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/tic_tac_toe_gui.html><strong aria-hidden=true>5.2.</strong> Tic Tac Toe GUI</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/square_tic_tac_toe_gui.html><strong aria-hidden=true>5.3.</strong> Square Tic Tac Toe GUI</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/square_tic_tac_toe_ai.html><strong aria-hidden=true>5.4.</strong> Square Tic Tac Toe AI</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/exercises.html><strong aria-hidden=true>5.5.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../what_next.html>What next?</a></li><br><hr><li class="chapter-item expanded"><i class="fa fa-github"id=git-repository-button></i><a href=https://github.com/learnbyexample/practice_python_projects>   Source code</a><li class="chapter-item expanded"><i class="fa fa-home"id=home-button></i><a href=https://learnbyexample.github.io/>   My Blog</a><li class="chapter-item expanded"><i class="fa fa-book"id=book-button></i><a href=https://learnbyexample.github.io/books/>   My Books</a><li class="chapter-item expanded"><i class="fa fa-envelope"id=mail-button></i><a href=https://learnbyexample.gumroad.com/l/learnbyexample-weekly>   learnbyexample weekly</a><li class="chapter-item expanded"><i class="fa fa-twitter"id=twitter-button></i><a href=https://twitter.com/learn_byexample>   Twitter</a></ol></div><div class=sidebar-resize-handle id=sidebar-resize-handle></div></nav><div class=page-wrapper id=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div class="menu-bar sticky bordered"id=menu-bar><div class=left-buttons><button aria-label="Toggle Table of Contents"title="Toggle Table of Contents"aria-controls=sidebar class=icon-button id=sidebar-toggle type=button><i class="fa fa-bars"></i></button><button aria-label="Change theme"title="Change theme"aria-controls=theme-list aria-expanded=false aria-haspopup=true class=icon-button id=theme-toggle type=button><i class="fa fa-paint-brush"></i></button><ul aria-label=Themes class=theme-popup id=theme-list role=menu><li role=none><button class=theme id=light role=menuitem>Light (default)</button><li role=none><button class=theme id=rust role=menuitem>Rust</button><li role=none><button class=theme id=coal role=menuitem>Coal</button><li role=none><button class=theme id=navy role=menuitem>Navy</button><li role=none><button class=theme id=ayu role=menuitem>Ayu</button></ul><button aria-label="Toggle Searchbar"title="Search. (Shortkey: s)"aria-controls=searchbar aria-expanded=false aria-keyshortcuts=S class=icon-button id=search-toggle type=button><i class="fa fa-search"></i></button></div><h1 class=menu-title>Practice Python Projects</h1><div class=right-buttons><a aria-label=Blog href=https://learnbyexample.github.io title=Blog> <i class="fa fa-home"id=home-button></i> </a><a aria-label=Twitter href=https://twitter.com/learn_byexample title=Twitter> <i class="fa fa-twitter"id=twitter-button></i> </a><a aria-label="Git repository"title="Git repository"href=https://github.com/learnbyexample/practice_python_projects> <i class="fa fa-github"id=git-repository-button></i> </a></div></div><div class=hidden id=search-wrapper><form class=searchbar-outer id=searchbar-outer><input placeholder="Search this book ..."aria-controls=searchresults-outer aria-describedby=searchresults-header id=searchbar name=searchbar type=search></form><div class="searchresults-outer hidden"id=searchresults-outer><div class=searchresults-header id=searchresults-header></div><ul id=searchresults></ul></div></div><script>document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });</script><div class=content id=content><main><div class=sidetoc><nav class=pagetoc></nav></div><h1 id=data-similarity><a class=header href=#data-similarity>Data similarity</a></h1><p>Now that you have all the author names, the next task is to take care of typos. You'll see how to use the <code>rapidfuzz</code> module for calculating the similarity between two strings. This helps to remove majority of the typos — for example <em>Courtney Schaefer</em> and <em>Courtney Shafer</em>. But, this would also introduce new errors if similar looking names are actually different authors and not typos — for example <em>R.J. Barker</em> and <em>R.J. Parker</em>.<p>From <a href=https://pypi.org/project/rapidfuzz/>pypi: rapidfuzz</a>:<blockquote><p>RapidFuzz is a fast string matching library for Python and C++, which is using the string similarity calculations from <a href=https://pypi.org/project/fuzzywuzzy/>FuzzyWuzzy</a>.</blockquote><p>From <a href=https://pypi.org/project/fuzzywuzzy/>pypi: fuzzywuzzy</a>:<blockquote><p>It uses <a href=https://en.wikipedia.org/wiki/Levenshtein_distance>Levenshtein Distance</a> to calculate the differences between sequences in a simple-to-use package.</blockquote><pre><code class=language-bash># virtual environment
$ pip install rapidfuzz

# normal environment
# use py instead of python3.13 for Windows
$ python3.13 -m pip install --user rapidfuzz
</code></pre><h2 id=examples><a class=header href=#examples>Examples</a></h2><p>Here are some examples of using the <code>fuzz.ratio()</code> method to calculate the similarity between two strings. Output of <code>100.0</code> means exact match.<pre><code class=language-python>>>> from rapidfuzz import fuzz

>>> fuzz.ratio('Courtney Schaefer', 'Courtney Schafer')
96.96969696969697
>>> fuzz.ratio('Courtney Schaefer', 'Courtney Shafer')
93.75
</code></pre><p>If you decide <code>90</code> as the cut-off limit, here are some cases that will be missed.<pre><code class=language-python>>>> fuzz.ratio('Ursella LeGuin', 'Ursula K. LeGuin')
80.0
>>> fuzz.ratio('robin hobb', 'Robin Hobb')
80.0
>>> fuzz.ratio('R. F. Kuang', 'RF Kuang')
84.21052631578947
</code></pre><p>Ignoring string case and removing the <code>.</code> characters before comparison helps in some cases.<pre><code class=language-python>>>> fuzz.ratio('robin hobb'.lower(), 'Robin Hobb'.lower())
100.0
>>> fuzz.ratio('R. F. Kuang'.replace('.', ''), 'RF Kuang'.replace('.', ''))
94.11764705882352
</code></pre><p>Here's an example where two different authors have only a single character difference. This would result in a false positive, which can be improved if the book names are also compared.<pre><code class=language-python>>>> fuzz.ratio('R.J. Barker', 'R.J. Parker')
90.9090909090909
</code></pre><h2 id=top-authors><a class=header href=#top-authors>Top authors</a></h2><p>The below program processes the author lists created earlier.<pre><code class=language-python># top_authors.py
from rapidfuzz import fuzz

ip_files = ('authors_2019.txt', 'authors_2021.txt')
op_files = ('top_authors_2019.csv', 'top_authors_2021.csv')

for ip_file, op_file in zip(ip_files, op_files):
    authors = {}
    with open(ip_file) as ipf, open(op_file, 'w') as opf:
        for line in ipf:
            name = line.rstrip('\n')
            authors[name] = authors.get(name, 0) + 1

        fuzzed = {}
        for k1 in sorted(authors, key=lambda k: -authors[k]):
            s1 = k1.lower().replace('.', '')
            for k2 in fuzzed:
                s2 = k2.lower().replace('.', '')
                if round(fuzz.ratio(s1, s2)) >= 90:
                    fuzzed[k2] += authors[k1]
                    break
            else:
                fuzzed[k1] = authors[k1]

        opf.write(f'Author,votes\n')
        for name in sorted(fuzzed, key=lambda k: -fuzzed[k]):
            votes = fuzzed[name]
            if votes >= 5:
                opf.write(f'{name},{votes}\n')
</code></pre><p>First, a naive histogram is created with the author name as the <em>key</em> and the total number of exact matches as the <em>value</em>.<p>Then, <code>rapidfuzz</code> is used to merge similar author names. The <code>sorted()</code> function is used to allow the most popular spelling to win.<p>Finally, the fuzzed dictionary is sorted again by highest votes and written to output files. The result is written in <code>csv</code> format with a header and a cut-off limit of minimum <code>5</code> votes.<p>Here's a table of the top-10 authors:<div class=table-wrapper><table><thead><tr><th>2021<th>Votes<th>2019<th>Votes<tbody><tr><td>Ursula K. Le Guin<td>139<td>N.K. Jemisin<td>58<tr><td>Robin Hobb<td>127<td>Ursula K. Le Guin<td>57<tr><td>N.K. Jemisin<td>127<td>Lois McMaster Bujold<td>52<tr><td>Martha Wells<td>113<td>Robin Hobb<td>47<tr><td>Lois McMaster Bujold<td>112<td>J.K. Rowling<td>47<tr><td>Naomi Novik<td>110<td>Naomi Novik<td>45<tr><td>Susanna Clarke<td>81<td>Becky Chambers<td>36<tr><td>Becky Chambers<td>76<td>Katherine Addison<td>33<tr><td>Katherine Addison<td>74<td>Martha Wells<td>30<tr><td>Madeline Miller<td>72<td>Jacqueline Carey<td>29</table></div><blockquote><p><img alt=info src=../images/info.svg> Note that the results you get might be different than what is shown here due to modification of the Reddit comments under analysis. Or, users might have deleted their comments and so on.</blockquote><p>If you wish to compare with the actual results, visit the threads linked below (see the comment section for author name based counts). The top-10 list shown above happens to match the actual results for both the polls, but with a slightly different order and vote counts.<ul><li><a href=https://old.reddit.com/r/Fantasy/comments/n713om/rfantasys_top_books_by_women_2021_results/>2021 poll results</a><li><a href=https://old.reddit.com/r/Fantasy/comments/cp4lls/rfantasys_top_female_authored_seriesbooks_2019/>2019 poll results</a></ul></main><nav aria-label="Page navigation"class=nav-wrapper><a aria-label="Previous chapter"class="mobile-nav-chapters previous"title="Previous chapter"aria-keyshortcuts=Left href=../poll_data_analysis/data_cleansing.html rel=prev> <i class="fa fa-angle-left"></i> </a><a aria-label="Next chapter"class="mobile-nav-chapters next"title="Next chapter"aria-keyshortcuts=Right href=../poll_data_analysis/exercises.html rel=next> <i class="fa fa-angle-right"></i> </a><div style="clear: both"></div></nav></div></div><nav aria-label="Page navigation"class=nav-wide-wrapper><a aria-label="Previous chapter"class="nav-chapters previous"title="Previous chapter"aria-keyshortcuts=Left href=../poll_data_analysis/data_cleansing.html rel=prev> <i class="fa fa-angle-left"></i> </a><a aria-label="Next chapter"class="nav-chapters next"title="Next chapter"aria-keyshortcuts=Right href=../poll_data_analysis/exercises.html rel=next> <i class="fa fa-angle-right"></i> </a></nav></div><script>window.playground_copyable = true;</script><script charset=utf-8 src=../elasticlunr.min.js></script><script charset=utf-8 src=../mark.min.js></script><script charset=utf-8 src=../searcher.js></script><script charset=utf-8 src=../clipboard.min.js></script><script charset=utf-8 src=../highlight.js></script><script charset=utf-8 src=../book.js></script><script src=../sidebar.js></script>