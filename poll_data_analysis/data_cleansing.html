<!doctypehtml><html class="sidebar-visible no-js light"lang=en><head><meta charset=UTF-8><title>Data cleansing - Practice Python Projects</title><meta content="text/html; charset=utf-8"http-equiv=Content-Type><meta content="Beginner to Intermediate level projects inspired by real world use cases"name=description><meta content=width=device-width,initial-scale=1 name=viewport><meta content=#ffffff name=theme-color><meta content="Practice Python Projects"property=og:title><meta content=website property=og:type><meta content="Beginner to Intermediate level projects inspired by real world use cases"property=og:description><meta content=https://learnbyexample.github.io/practice_python_projects/ property=og:url><meta content=https://raw.githubusercontent.com/learnbyexample/practice_python_projects/main/images/py_projects_ls.png property=og:image><meta content=1280 property=og:image:width><meta content=720 property=og:image:height><meta content=summary_large_image property=twitter:card><meta content=@learn_byexample property=twitter:site><link href=../favicon.svg rel=icon><link rel="shortcut icon"href=../favicon.png><link href=../css/variables.css rel=stylesheet><link href=../css/general.css rel=stylesheet><link href=../css/chrome.css rel=stylesheet><link href=../FontAwesome/css/font-awesome.css rel=stylesheet><link href=../fonts/fonts.css rel=stylesheet><link href=../highlight.css rel=stylesheet><link href=../tomorrow-night.css rel=stylesheet><link href=../ayu-highlight.css rel=stylesheet><link href=../style.css rel=stylesheet><body><script>var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";</script><script>try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }</script><script>var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');</script><script>var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);</script><nav aria-label="Table of contents"class=sidebar id=sidebar><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded affix"><a href=../cover.html>Cover</a><li class="chapter-item expanded affix"><a href=../buy.html>Buy PDF/EPUB versions</a><li class="chapter-item expanded affix"><a href=../preface.html>Preface</a><li class="chapter-item expanded"><a href=../calculator/calculator.html><strong aria-hidden=true>1.</strong> CLI Calculator</a><li><ol class=section><li class="chapter-item expanded"><a href=../calculator/calc_bash_func.html><strong aria-hidden=true>1.1.</strong> Bash shortcuts</a><li class="chapter-item expanded"><a href=../calculator/calc_py_cli.html><strong aria-hidden=true>1.2.</strong> Python CLI application</a><li class="chapter-item expanded"><a href=../calculator/exercises.html><strong aria-hidden=true>1.3.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../poll_data_analysis/poll_data_analysis.html><strong aria-hidden=true>2.</strong> Poll Data Analysis</a><li><ol class=section><li class="chapter-item expanded"><a href=../poll_data_analysis/praw.html><strong aria-hidden=true>2.1.</strong> Getting Reddit comments using praw</a><li class="chapter-item expanded"><a class=active href=../poll_data_analysis/data_cleansing.html><strong aria-hidden=true>2.2.</strong> Data cleansing</a><li class="chapter-item expanded"><a href=../poll_data_analysis/data_similarity.html><strong aria-hidden=true>2.3.</strong> Data similarity</a><li class="chapter-item expanded"><a href=../poll_data_analysis/exercises.html><strong aria-hidden=true>2.4.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../find_typos/find_typos.html><strong aria-hidden=true>3.</strong> Finding typos</a><li><ol class=section><li class="chapter-item expanded"><a href=../find_typos/plain_text.html><strong aria-hidden=true>3.1.</strong> Plain text input</a><li class="chapter-item expanded"><a href=../find_typos/markdown.html><strong aria-hidden=true>3.2.</strong> Markdown input</a><li class="chapter-item expanded"><a href=../find_typos/exercises.html><strong aria-hidden=true>3.3.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../mcq/multiple_choice_questions.html><strong aria-hidden=true>4.</strong> Multiple choice questions</a><li><ol class=section><li class="chapter-item expanded"><a href=../mcq/input_mcq.html><strong aria-hidden=true>4.1.</strong> Using input function</a><li class="chapter-item expanded"><a href=../mcq/tkinter_intro.html><strong aria-hidden=true>4.2.</strong> Tkinter introduction</a><li class="chapter-item expanded"><a href=../mcq/gui_mcq.html><strong aria-hidden=true>4.3.</strong> MCQ GUI</a><li class="chapter-item expanded"><a href=../mcq/exercises.html><strong aria-hidden=true>4.4.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../square_tic_tac_toe/square_tic_tac_toe.html><strong aria-hidden=true>5.</strong> Square Tic Tac Toe</a><li><ol class=section><li class="chapter-item expanded"><a href=../square_tic_tac_toe/grid_and_images.html><strong aria-hidden=true>5.1.</strong> Grid layout and images</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/tic_tac_toe_gui.html><strong aria-hidden=true>5.2.</strong> Tic Tac Toe GUI</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/square_tic_tac_toe_gui.html><strong aria-hidden=true>5.3.</strong> Square Tic Tac Toe GUI</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/square_tic_tac_toe_ai.html><strong aria-hidden=true>5.4.</strong> Square Tic Tac Toe AI</a><li class="chapter-item expanded"><a href=../square_tic_tac_toe/exercises.html><strong aria-hidden=true>5.5.</strong> Exercises</a></ol><li class="chapter-item expanded"><a href=../what_next.html>What next?</a></li><br><hr><li class="chapter-item expanded"><i class="fa fa-github"id=git-repository-button></i><a href=https://github.com/learnbyexample/practice_python_projects>   Source code</a><li class="chapter-item expanded"><i class="fa fa-home"id=home-button></i><a href=https://learnbyexample.github.io/>   My Blog</a><li class="chapter-item expanded"><i class="fa fa-book"id=book-button></i><a href=https://learnbyexample.github.io/books/>   My Books</a><li class="chapter-item expanded"><i class="fa fa-envelope"id=mail-button></i><a href=https://learnbyexample.gumroad.com/l/learnbyexample-weekly>   learnbyexample weekly</a><li class="chapter-item expanded"><i class="fa fa-twitter"id=twitter-button></i><a href=https://twitter.com/learn_byexample>   Twitter</a></ol></div><div class=sidebar-resize-handle id=sidebar-resize-handle></div></nav><div class=page-wrapper id=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div class="menu-bar sticky bordered"id=menu-bar><div class=left-buttons><button aria-label="Toggle Table of Contents"title="Toggle Table of Contents"aria-controls=sidebar class=icon-button id=sidebar-toggle type=button><i class="fa fa-bars"></i></button><button aria-label="Change theme"title="Change theme"aria-controls=theme-list aria-expanded=false aria-haspopup=true class=icon-button id=theme-toggle type=button><i class="fa fa-paint-brush"></i></button><ul aria-label=Themes class=theme-popup id=theme-list role=menu><li role=none><button class=theme id=light role=menuitem>Light (default)</button><li role=none><button class=theme id=rust role=menuitem>Rust</button><li role=none><button class=theme id=coal role=menuitem>Coal</button><li role=none><button class=theme id=navy role=menuitem>Navy</button><li role=none><button class=theme id=ayu role=menuitem>Ayu</button></ul><button aria-label="Toggle Searchbar"title="Search. (Shortkey: s)"aria-controls=searchbar aria-expanded=false aria-keyshortcuts=S class=icon-button id=search-toggle type=button><i class="fa fa-search"></i></button></div><h1 class=menu-title>Practice Python Projects</h1><div class=right-buttons><a aria-label=Blog href=https://learnbyexample.github.io title=Blog> <i class="fa fa-home"id=home-button></i> </a><a aria-label=Twitter href=https://twitter.com/learn_byexample title=Twitter> <i class="fa fa-twitter"id=twitter-button></i> </a><a aria-label="Git repository"title="Git repository"href=https://github.com/learnbyexample/practice_python_projects> <i class="fa fa-github"id=git-repository-button></i> </a></div></div><div class=hidden id=search-wrapper><form class=searchbar-outer id=searchbar-outer><input placeholder="Search this book ..."aria-controls=searchresults-outer aria-describedby=searchresults-header id=searchbar name=searchbar type=search></form><div class="searchresults-outer hidden"id=searchresults-outer><div class=searchresults-header id=searchresults-header></div><ul id=searchresults></ul></div></div><script>document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });</script><div class=content id=content><main><div class=sidetoc><nav class=pagetoc></nav></div><h1 id=data-cleansing><a class=header href=#data-cleansing>Data cleansing</a></h1><p>Now that you've seen a basic example with the <code>praw</code> module, you'll start this project by getting the top level comments from two Reddit threads. These threads were used to conduct a poll about favorite speculative fiction written by women. From the raw data so obtained, author names have to be extracted. But the data format isn't always as expected. You'll use regular expressions to explore inconsistencies, remove unwanted characters from the names and ignore entries that couldn't be parsed in the format required.<p>From <a href=https://en.wikipedia.org/wiki/Data_cleansing>wikipedia: Data cleansing</a>:<blockquote><p>Data cleansing or data cleaning is the process of identifying and correcting (or removing) corrupt, inaccurate, or irrelevant records from a dataset, table, or database. It involves detecting incomplete, incorrect, or inaccurate parts of the data and then replacing, modifying, or deleting the affected data. Data cleansing can be performed interactively using data wrangling tools, or through batch processing often via scripts or a data quality firewall.</blockquote><h2 id=collecting-data><a class=header href=#collecting-data>Collecting data</a></h2><p>The two poll threads being analyzed for this project are <a href=https://old.reddit.com/r/Fantasy/comments/cib77j/the_rfantasy_top_female_authored_works_2019/>2019</a> and <a href=https://old.reddit.com/r/Fantasy/comments/m20rd1/the_rfantasy_top_books_by_women_2021_edition/>2021</a>. The poll asked users to specify their favorite speculative fictional books written by women, with a maximum of 10 entries. The voting comment was restricted to contain only book titles and authors. Any other discussion had to be placed under those entries as comments.<p>The below program builds on the example shown earlier. A <code>tuple</code> object stores the voting thread <em>year</em> and the corresponding <em>id</em> values. And then a loop goes over each entry and writes only the top level comments to the respective output files.<pre><code class=language-python># save_top_comments.py
import json
import praw

with open('.secrets/tokens.json') as f:
    secrets = json.load(f)

reddit = praw.Reddit(
    user_agent=secrets['user_agent'],
    client_id=secrets['client_id'],
    client_secret=secrets['client_secret'],
)

thread_details = (('2019', 'cib77j'), ('2021', 'm20rd1'))

for year, thread_id in thread_details:
    submission = reddit.submission(id=thread_id)
    submission.comments.replace_more(limit=None)

    op_file = f'top_comments_{year}.txt'
    with open(op_file, 'w') as f:
        for top_level_comment in submission.comments:
            f.write(top_level_comment.body + '\n')
</code></pre><p>The <code>tokens.json</code> file contains the information passed to the <code>praw.Reddit()</code> method. The data structure is shown below — you'll need to replace the values with your own valid information.<pre><code class=language-bash>$ cat .secrets/tokens.json 
{
    "user_agent": "Get Comments by /u/name",
    "client_id": "XXX",
    "client_secret": "XXX"
}
</code></pre><h2 id=data-inconsistencies><a class=header href=#data-inconsistencies>Data inconsistencies</a></h2><p>As mentioned earlier, the poll asked users to specify their favorite speculative fictional books written by women, with a maximum of 10 entries. Users were also instructed to use only one entry per series, but series name or any individual book title can be specified. To analyze this data as intended, you'll have to find a way to collate all entries that fall under the same series. This is out of scope for this project. Instead, only author names will be used for the analysis, which is a significant deviation from the poll's intention.<p>Counting author names alone makes it easier to code this project, but you'll still come to appreciate why data cleansing is a very important step. Users were asked to write their entries as book title followed by hyphen or the word <code>by</code> and finally the author name. Assuming there is at least one whitespace character before and after the separators, here's a program that displays all the mismatching lines.<pre><code class=language-python>import re

file = 'top_comments_2019.txt'
pat = re.compile(r'\s(?:[–-]|by)\s', flags=re.I)

with open(file) as f:
    for line in f:
        if re.fullmatch(r'\s+', line):
            continue
        elif not pat.search(line):
            print(line, end='')
</code></pre><p>The <code>re.fullmatch</code> regexp is used to ignore all lines containing only whitespaces. The next regexp checks if hyphen (or em dash) or <code>by</code> surrounded by whitespace characters is present in the line. Case is also ignored when <code>by</code> is matched. Matching the whitespace characters is important because the book titles or author names could contain <code>by</code> or hyphens. While this can still give false matches, the goal is to reduce errors as much as possible, not 100% accuracy. If a line doesn't match this condition, it will be displayed on the screen. About a hundred such lines are found in the <code>top_comments_2019.txt</code> file.<p>Here's a visual representation of the <code>pat</code> regexp:<p align=center><img alt="Regexp matching railroad diagram"src=../images/poll_data_analysis/regexp_matching.png><blockquote><p><img alt=info src=../images/info.svg> The above railroad diagram for the <code>r'\s(?:[–-]|by)\s'</code> pattern was created using the <a href=https://www.debuggex.com>debuggex</a> site. You can also visit this <a href=https://regex101.com/r/NPuLfF/1>regex101 link</a>, which is another popular way to experiment and understand regexp patterns. See my <a href=https://learnbyexample.github.io/py_regular_expressions/>Python re(gex)?</a> ebook if you want to learn more about regular expressions.</blockquote><p>And here's a sample of the mismatching lines:<pre><code class=language-nohighlight>**Wayfarers** \- Becky Chambers
**The Broken Earth** *by N.K. Jemisin*
5. Uprooted- Naomi Novik
Empire of Sand, Tasha Suri
</code></pre><p>So, some entries used a slightly different markdown style and some used <code>,</code> as the separator. The first two cases can be allowed by optionally matching the <code>\</code> or <code>*</code> characters. The last two cases will require breaking the whitespace matching rule. For now, this will be allowed so as to proceed further. But in the next section you will see how to apply regexp on a priority basis so that the different rules are applied only for the mismatching lines.<p>The modified program is shown below. The <code>re.X</code> flag allows you to use literal whitespaces for readability purposes. You can also add comments after the <code>#</code> character if you wish.<pre><code class=language-python># analyze.py
import re

file = 'top_comments_2019.txt'
pat = re.compile(r'''\s(?:[–-]|by)\s
                     |\s\\[–-]\s
                     |\s\*by\s
                     |[,-]\s
                  ''', flags=re.I|re.X)

with open(file) as f:
    for line in f:
        if re.fullmatch(r'\s+', line):
            continue
        elif not pat.search(line):
            print(line, end='')
</code></pre><p>After applying this rule, there are less than 50 mismatching lines. Some of them are comments irrelevant to the voting, but some of the entries can still be salvaged by manual modification (for example, entries that have the book title and author names in reversed order). These will be completely ignored for this project, but you can try to correct them if you wish.<p>Changing the input file to <code>top_comments_2021.txt</code> gives new kind of mismatches. Some of the mismatches are shown below:<pre><code class=language-nohighlight>The Blue Sword-Robin McKinley
**The Left Hand of Darkness**by Ursula K. Le Guin
Spinning Silver (Naomi Novik)
</code></pre><p>These can be accommodated by modifying the matching criteria, but since the total count of mismatches is less than 40, they will also be ignored. You can try to improve the code as an exercise. In case you are wondering, total entries are more than 1500 and 3400 for the 2019 and 2021 polls respectively. So, ignoring less than 50 mismatches isn't a substantial loss.<blockquote><p><img alt=info src=../images/info.svg> Note that the results you get might be different than what is shown here due to modification of the Reddit comments under analysis. Or, users might have deleted their comments and so on.</blockquote><h2 id=extracting-author-names><a class=header href=#extracting-author-names>Extracting author names</a></h2><p>It is time to extract only the author names and save them for further analysis. The regexp patterns seen in the previous section needs to modified to capture author names at the end of the lines. Also, <code>.*</code> is added at the start so that only the furthest match in the line is extracted. To give priority for the best case matches, the patterns are first stored separately as different elements in a <code>tuple</code>. By looping over these patterns, you can then quit once the earliest match is found.<pre><code class=language-python># extract_author_names.py
import re

ip_files = ('top_comments_2019.txt', 'top_comments_2021.txt')
op_files = ('authors_2019.txt', 'authors_2021.txt')

patterns = (r'.*\s(?:[–-]|by)\s+(.+)',
            r'.*\s\\[–-]\s+(.+)',
            r'.*\s\*by\s+(.+)',
            r'.*[,-]\s+(.+)')

for ip_file, op_file in zip(ip_files, op_files):
    with open(ip_file) as ipf, open(op_file, 'w') as opf:
        for line in ipf:
            if re.fullmatch(r'\s+', line):
                continue
            for pat in patterns:
                if m := re.search(pat, line, flags=re.I):
                    opf.write(m[1].strip('*\t ') + '\n')
                    break
</code></pre><p>If you check the two output files you get, you'll see some entries like shown below. Again, managing these entries is left as an exercise.<pre><code class=language-nohighlight>Janny Wurts & Raymond E. Feist
Patricia C. Wrede, Caroline Stevermer
Melaine Rawn, Jennifer Roberson, and Kate Elliott
and get to add some stuff I really enjoyed! In no particular order:
but:
Marie Brennan (Memoirs of Lady Trent) 
Alice B. Sheldon (as James Tiptree Jr.)
Linda Nagata from The Red trilogy 
Novik, Naomi
</code></pre><p><code>strip('*\t ')</code> is applied on the captured portion to remove whitespaces at the end of the line, markdown formatting, etc. Without that, you'll get author names likes shown below:<pre><code class=language-nohighlight>N.K. Jemisin*
ML Wang**
*Mary Robinette Kowal
</code></pre></main><nav aria-label="Page navigation"class=nav-wrapper><a aria-label="Previous chapter"class="mobile-nav-chapters previous"title="Previous chapter"aria-keyshortcuts=Left href=../poll_data_analysis/praw.html rel=prev> <i class="fa fa-angle-left"></i> </a><a aria-label="Next chapter"class="mobile-nav-chapters next"title="Next chapter"aria-keyshortcuts=Right href=../poll_data_analysis/data_similarity.html rel=next> <i class="fa fa-angle-right"></i> </a><div style="clear: both"></div></nav></div></div><nav aria-label="Page navigation"class=nav-wide-wrapper><a aria-label="Previous chapter"class="nav-chapters previous"title="Previous chapter"aria-keyshortcuts=Left href=../poll_data_analysis/praw.html rel=prev> <i class="fa fa-angle-left"></i> </a><a aria-label="Next chapter"class="nav-chapters next"title="Next chapter"aria-keyshortcuts=Right href=../poll_data_analysis/data_similarity.html rel=next> <i class="fa fa-angle-right"></i> </a></nav></div><script>window.playground_copyable = true;</script><script charset=utf-8 src=../elasticlunr.min.js></script><script charset=utf-8 src=../mark.min.js></script><script charset=utf-8 src=../searcher.js></script><script charset=utf-8 src=../clipboard.min.js></script><script charset=utf-8 src=../highlight.js></script><script charset=utf-8 src=../book.js></script><script src=../sidebar.js></script>